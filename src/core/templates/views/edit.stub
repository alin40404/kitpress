<?php
if (!defined('ABSPATH')) {
    exit;
}

/**
 * @var array $detail 数据
 */
?>
<div class="wrap">
    <h1 class="wp-heading-inline">
        <?php echo $detail->id ? '编辑模型' : '添加模型'; ?>
    </h1>

    <form id="table-form" method="post" @submit.prevent="submitForm">
        <table class="form-table">
            <tr>
                <th scope="row"><label for="name">模型名称</label></th>
                <td>
                    <input type="text"
                           id="name"
                           v-model="form.name"
                           class="regular-text"
                           required>
                    <p class="description">显示用的名称，如：GPT-4</p>
                </td>
            </tr>

            <tr>
                <th scope="row"><label for="slug">模型标识</label></th>
                <td>
                    <input type="text"
                           id="slug"
                           v-model="form.slug"
                           class="regular-text"
                           required
                           pattern="[a-z0-9-]+"
                           :readonly="form.id > 0">
                    <p class="description">唯一标识符，仅允许小写字母、数字和横线，如：gpt-4</p>
                </td>
            </tr>

            <tr>
                <th scope="row"><label for="type">类型</label></th>
                <td>
                    <select id="type" v-model="form.type" required>
                        <option value="chat">对话模型</option>
                        <option value="image">图像模型</option>
                    </select>
                </td>
            </tr>

            <tr>
                <th scope="row"><label for="provider">提供商</label></th>
                <td>
                    <select id="provider" v-model="form.provider" required>
                        <option value="openai">OpenAI</option>
                        <option value="anthropic">Anthropic</option>
                    </select>
                </td>
            </tr>

            <tr>
                <th scope="row"><label for="input_price">输入价格</label></th>
                <td>
                    <input type="number"
                           id="input_price"
                           v-model.number="form.input_price"
                           class="small-text"
                           step="0.000001"
                           min="0">
                    <span class="description">美元/1K tokens</span>
                </td>
            </tr>

            <tr>
                <th scope="row"><label for="output_price">输出价格</label></th>
                <td>
                    <input type="number"
                           id="output_price"
                           v-model.number="form.output_price"
                           class="small-text"
                           step="0.000001"
                           min="0">
                    <span class="description">美元/1K tokens</span>
                </td>
            </tr>

            <tr v-if="form.type === 'image'">
                <th scope="row"><label>图片价格配置</label></th>
                <td>
                    <div v-for="(prices, size) in imagePrices" :key="size" class="image-price-row">
                        <span>{{size}}</span>
                        <input type="number"
                               v-model.number="prices.standard"
                               class="small-text"
                               step="0.000001"
                               min="0">
                        <span>标准质量</span>
                        <input type="number"
                               v-model.number="prices.hd"
                               class="small-text"
                               step="0.000001"
                               min="0">
                        <span>高清质量</span>
                    </div>
                </td>
            </tr>

            <tr>
                <th scope="row"><label for="max_tokens">最大token数</label></th>
                <td>
                    <input type="number"
                           id="max_tokens"
                           v-model.number="form.max_tokens"
                           class="small-text"
                           min="0">
                    <p class="description">0表示使用默认值</p>
                </td>
            </tr>

            <tr>
                <th scope="row">高级功能</th>
                <td>
                    <label>
                        <input type="checkbox"
                               v-model="form.supports_functions">
                        支持函数调用
                    </label>
                    <br>
                    <label>
                        <input type="checkbox"
                               v-model="form.supports_vision">
                        支持图像识别
                    </label>
                </td>
            </tr>

            <tr>
                <th scope="row">状态</th>
                <td>
                    <label>
                        <input type="checkbox"
                               v-model="form.is_active">
                        启用
                    </label>
                </td>
            </tr>

            <tr>
                <th scope="row"><label for="sort_order">排序</label></th>
                <td>
                    <input type="number"
                           id="sort_order"
                           v-model.number="form.sort_order"
                           class="small-text"
                           min="0">
                </td>
            </tr>
        </table>

        <p class="submit">
            <button type="submit" class="button button-primary" :disabled="loading">
                保存更改
                <span v-if="loading" class="spinner is-active"></span>
            </button>
            <a href="<?php echo admin_url('admin.php?page=wan-api-models'); ?>"
               class="button">
                返回列表
            </a>

        </p>
    </form>
</div>

<script>
    window.modelsDetail = <?php echo json_encode($detail); ?>;
</script>